import {format,transports,createLogger}from'winston';import'winston-daily-rotate-file';import M from'bcrypt';import h from'crypto';var B=Object.defineProperty;var a=(t,e)=>{for(var r in e)B(t,r,{get:e[r],enumerable:true});};var v={};a(v,{authentication:()=>u,errorHandler:()=>f,responseHandler:()=>j,routeLogger:()=>R,schemas:()=>g});var x={};a(x,{ANSI:()=>d,colorize:()=>c,logger:()=>l});var d=(n=>(n.RESET="\x1B[0m",n.FAINT="\x1B[2m",n.RED="\x1B[31m",n.GREEN="\x1B[32m",n.YELLOW="\x1B[33m",n.BLUE="\x1B[34m",n.MAGENTA="\x1B[35m",n.BOLD_RED="\x1B[1;31m",n))(d||{}),c=(t,e)=>`${e}${t}\x1B[0m`;var k=format.combine(format.timestamp(),format(t=>(t.level=t.level.toUpperCase().padStart(7),t))()),A=new transports.Console({format:format.combine(k,format.colorize(),format.printf(t=>{let e=t.message;return [c(t.timestamp,"\x1B[2m"),t.level,c(`[${e.ip??e.socket.remoteAddress??"unknown"}]`,"\x1B[35m"),c(e.method,"\x1B[33m"),e.path].join(" ")}))}),S=new transports.DailyRotateFile({format:format.combine(k,format.printf(t=>{let e=t.message;return [t.timestamp,t.level,`[${e.ip??e.socket.remoteAddress??"unknown"}]`,e.method,e.path].join(" ")})),auditFile:"logs/.audit",filename:"logs/%DATE%.log",maxFiles:"28d"}),l=createLogger({level:"debug",transports:[A,S],handleExceptions:true,handleRejections:true});var R=(t,e,r)=>{l.info(t),r();};var j=(t,e,r)=>{e.ok=o=>{e.json({data:o});},r();};var f={};a(f,{api:()=>_,www:()=>z});var _=(t,e,r,o)=>{r.statusCode===200&&r.status(500),t instanceof Error&&JSON.stringify(t)==="{}"?r.json({error:{name:t.name,message:t.message}}):r.json({error:t});};var z=(t,e)=>(r,o,s,E)=>{let i=typeof t=="string"?t:t?.[s.statusCode],p=(typeof e=="string"?e:e?.[s.statusCode])??(r instanceof Error?r.message:"Unknown error");s.send(`
    <script>
      alert("${p}");
      ${i?`window.location.replace("${i}")`:"history.back()"}
    </script>
  `);};var u={};a(u,{local:()=>O});var O=(t,e,r)=>{let o=t.ip??t.socket.remoteAddress;if(o!=="::1"&&o!=="localhost")throw e.status(401),new Error("Unauthorized");r();};var g={};a(g,{joi:()=>C,superstruct:()=>D,zod:()=>F});var C=t=>async(e,r,o)=>{try{e.body=await t.validateAsync(e.body);}catch(s){throw r.status(422),s}o();};var D=t=>(e,r,o)=>{try{e.body=t.create(e.body);}catch(s){throw r.status(422),s}o();};var F=t=>async(e,r,o)=>{try{e.body=await t.parseAsync(e.body);}catch(s){throw r.status(422),s}o();};var L={};a(L,{logging:()=>x,password:()=>b});var b={};a(b,{bcrypt:()=>y,hmac:()=>w});var y={};a(y,{hash:()=>H,verify:()=>U});var H=async t=>M.hash(t,10),U=async(t,e)=>M.compare(t,e);var w={};a(w,{hash:()=>q,verify:()=>G});var q=(t,e="sha256",r="base64")=>{let o=h.randomBytes(16),s=h.createHmac(e,o).update(t);return Buffer.concat([o,s.digest()]).toString(r)},G=(t,e,r="sha256",o="base64")=>{let s=Buffer.from(e,o),[E,i]=[s.subarray(0,16),s.subarray(16)],p=h.createHmac(r,E).update(t);return i.toString(o)===p.digest(o)};export{v as middleware,L as utils};