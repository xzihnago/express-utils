import {format,transports,createLogger}from'winston';import'winston-daily-rotate-file';import v from'jsonwebtoken';var b=Object.defineProperty;var i=(e,t)=>{for(var o in t)b(e,o,{get:t[o],enumerable:true});};var c=(e,t)=>`${t}${e}\x1B[0m`;var l=format.combine(format.timestamp(),format(e=>(e.level=e.level.toUpperCase().padStart(7),e))()),h=new transports.Console({format:format.combine(l,format.colorize(),format.printf(e=>{let t=e.message;return [c(e.timestamp,"\x1B[2m"),e.level,c(`[${t.ip??t.socket.remoteAddress??"unknown"}]`,"\x1B[35m"),c(t.method,"\x1B[33m"),t.path].join(" ")}))}),y=new transports.DailyRotateFile({format:format.combine(l,format.printf(e=>{let t=e.message;return [e.timestamp,e.level,`[${t.ip??t.socket.remoteAddress??"unknown"}]`,t.method,t.path].join(" ")})),auditFile:"logs/.audit",filename:"logs/%DATE%.log",maxFiles:"28d"}),d=createLogger({level:"debug",transports:[h,y],handleExceptions:true,handleRejections:true});var E=(e,t,o)=>{d.info(e),o();};var j=(e,t,o)=>{t.ok=r=>{t.json({data:r});},o();};var u={};i(u,{api:()=>k,www:()=>R});var k=(e,t,o,r)=>{o.statusCode===200&&o.status(500),e instanceof Error&&JSON.stringify(e)==="{}"?o.json({error:{name:e.name,message:e.message}}):o.json({error:e});};var R=(e,t)=>(o,r,s,m)=>{let a=typeof e=="string"?e:e?.[s.statusCode],f=(typeof t=="string"?t:t?.[s.statusCode])??(o instanceof Error?o.message:"Unknown error");s.send(`
    <script>
      alert("${f}");
      ${a?`window.location.replace("${a}")`:"history.back()"}
    </script>
  `);};var w={};i(w,{jwt:()=>L,local:()=>M});var M=(e,t,o)=>{let r=e.ip??e.socket.remoteAddress;if(r!=="::1"&&r!=="localhost")throw t.status(401),new Error("Unauthorized");o();};var L=(e,t,o={})=>(r,s,m)=>{try{r.jwt=Object.assign(v.verify(e,t,Object.assign(o,{complete:!0})),{raw:e});}catch(a){throw s.status(401),a}m();};var x={};i(x,{joi:()=>O,superstruct:()=>$,zod:()=>A});var O=e=>async(t,o,r)=>{try{t.body=await e.validateAsync(t.body);}catch(s){throw o.status(422),s}r();};var $=e=>(t,o,r)=>{try{t.body=e.create(t.body);}catch(s){throw o.status(422),s}r();};var A=e=>async(t,o,r)=>{try{t.body=await e.parseAsync(t.body);}catch(s){throw o.status(422),s}r();};export{w as authentication,u as errorHandler,j as responseHandler,E as routeLogger,x as validateSchema};