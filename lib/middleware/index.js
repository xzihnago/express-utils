import {format,transports,createLogger}from'winston';import'winston-daily-rotate-file';var b=Object.defineProperty;var m=(e,t)=>{for(var o in t)b(e,o,{get:t[o],enumerable:true});};var i=(e,t)=>`${t}${e}\x1B[0m`;var p=format.combine(format.timestamp(),format(e=>(e.level=e.level.toUpperCase().padStart(7),e))()),g=new transports.Console({format:format.combine(p,format.colorize(),format.printf(e=>{let t=e.message;return [i(e.timestamp,"\x1B[2m"),e.level,i(`[${t.ip??t.socket.remoteAddress??"unknown"}]`,"\x1B[35m"),i(t.method,"\x1B[33m"),t.path].join(" ")}))}),h=new transports.DailyRotateFile({format:format.combine(p,format.printf(e=>{let t=e.message;return [e.timestamp,e.level,`[${t.ip??t.socket.remoteAddress??"unknown"}]`,t.method,t.path].join(" ")})),auditFile:"logs/.audit",filename:"logs/%DATE%.log",maxFiles:"28d"}),l=createLogger({level:"debug",transports:[g,h],handleExceptions:true,handleRejections:true});var E=(e,t,o)=>{l.info(e),o();};var k=(e,t,o)=>{t.ok=r=>{t.json({data:r});},o();};var u={};m(u,{api:()=>R,www:()=>j});var R=(e,t,o,r)=>{o.statusCode===200&&o.status(500),e instanceof Error&&JSON.stringify(e)==="{}"?o.json({error:{name:e.name,message:e.message}}):o.json({error:e});};var j=(e,t)=>(o,r,s,n)=>{let c=typeof e=="string"?e:e?.[s.statusCode],f=(typeof t=="string"?t:t?.[s.statusCode])??(o instanceof Error?o.message:"Unknown error");s.send(`
    <script>
      alert("${f}");
      ${c?`window.location.replace("${c}")`:"history.back()"}
    </script>
  `);};var y={};m(y,{local:()=>M});var M=(e,t,o)=>{let r=e.ip??e.socket.remoteAddress;if(r!=="::1"&&r!=="localhost")throw t.status(401),new Error("Unauthorized");o();};var x={};m(x,{joi:()=>v,superstruct:()=>A,zod:()=>L});var v=(e,t="body")=>async(o,r,s)=>{try{t==="body"?o.body=await e.validateAsync(o.body):await e.validateAsync(o.query);}catch(n){throw r.status(422),n}s();};var A=(e,t="body")=>(o,r,s)=>{try{t==="body"?o.body=e.create(o.body):e.create(o.query);}catch(n){throw r.status(422),n}s();};var L=(e,t="body")=>async(o,r,s)=>{try{t==="body"?o.body=await e.parseAsync(o.body):await e.parseAsync(o.query);}catch(n){throw r.status(422),n}s();};export{y as authentication,u as errorHandler,k as responseHandler,E as routeLogger,x as schemas};