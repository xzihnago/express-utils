import y from'jsonwebtoken';import {create}from'superstruct';var l=Object.defineProperty;var c=(e,o)=>{for(var t in o)l(e,t,{get:o[t],enumerable:true});};var w=(e,o,t)=>{let r=new Date().toISOString(),s=e.ip??e.socket.remoteAddress??"unknown";console.log(`\x1B[0;36m[${r}] \x1B[0;35m[${s}] \x1B[0;33m${e.method} \x1B[0m${e.path}`),t();};var f=(e,o,t)=>{o.ok=r=>{o.json({data:r});},t();};var d={};c(d,{api:()=>u,www:()=>x});var u=(e,o,t,r)=>{t.statusCode===200&&t.status(500),e instanceof Error&&JSON.stringify(e)==="{}"?t.json({error:{name:e.name,message:e.message}}):t.json({error:e});};var x=(e,o)=>(t,r,s,a)=>{let n;e&&typeof e=="object"&&(n=e[s.statusCode]);let i;o?typeof o=="string"?i=o:i=o[s.statusCode]:t instanceof Error&&(i=t.message),i??="Unknown error",s.send(`
      <script>
        alert("${i}");
        ${n?`window.location.replace("${n}")`:"history.back()"}
      </script>
    `);};var p={};c(p,{jwt:()=>b,local:()=>h});var h=(e,o,t)=>{let r=e.ip??e.socket.remoteAddress;if(r!=="::1"&&r!=="localhost")throw o.status(401),new Error("Unauthorized");t();};var b=(e,o)=>(t,r,s)=>{let a=t.headers.authorization?.split(" ")[1];if(!a&&o&&(a=t.signedCookies?.[o]??t.cookies?.[o]),!a)throw r.status(401),new Error("No authorization header or cookie");try{let n=y.verify(a,e);t.jwt={token:a,decoded:n};}catch(n){throw r.status(401),n}s();};var m={};c(m,{joi:()=>g,superstruct:()=>j,zod:()=>S});var g=e=>async(o,t,r)=>{try{o.body=await e.validateAsync(o.body);}catch(s){throw t.status(422),s}r();};var j=e=>(o,t,r)=>{try{o.body=create(o.body,e);}catch(s){throw t.status(422),s}r();};var S=e=>async(o,t,r)=>{try{o.body=await e.parseAsync(o.body);}catch(s){throw t.status(422),s}r();};export{p as authentication,d as errorHandler,f as responseHandler,w as routeLog,m as validateSchema};